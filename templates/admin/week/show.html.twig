{% extends 'base.html.twig' %}

{% block title %}Tydzień {{ week.weekNumber }}/{{ week.year }}{% endblock %}

{% block body %}
<div class="bg-white text-slate-900">
    <div class="max-w-[1100px] mx-auto px-6 py-12" id="week-view" 
         data-done-url-pattern="{{ path('admin_week_task_done', {'id': 'TASK_ID'}) }}"
         data-undo-url-pattern="{{ path('admin_week_task_undo', {'id': 'TASK_ID'}) }}">
        
        <!-- Header Card -->
        <div class="bg-white border border-slate-200 rounded-2xl p-8 mb-8 shadow-sm">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6">
                <div class="flex items-center gap-6">
                    <a href="{{ path('admin_week_show', {'year': prev_week.year, 'week': prev_week.week}) }}" 
                       class="p-3 rounded-xl bg-slate-50 text-slate-400 hover:text-slate-900 hover:bg-slate-100 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </a>
                    <div>
                        <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 leading-none mb-2 italic">
                            Tydzień {{ week.weekNumber }} / {{ week.year }}
                        </h1>
                        <span class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider {{ week.status == 'OPEN' ? 'bg-orange-100 text-orange-700' : 'bg-slate-100 text-slate-600' }}">
                            {{ week.status == 'OPEN' ? 'TRYB OPERACYJNY' : 'TYDZIEŃ ZAMKNIĘTY' }}
                        </span>
                    </div>
                    <a href="{{ path('admin_week_show', {'year': next_week.year, 'week': next_week.week}) }}" 
                       class="p-3 rounded-xl bg-slate-50 text-slate-400 hover:text-slate-900 hover:bg-slate-100 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </a>
                </div>
                <div class="flex flex-wrap items-center gap-3">
                    <form method="post" action="{{ path('admin_week_generate', {'year': week.year, 'week': week.weekNumber}) }}" class="inline">
                        <button type="submit" class="bg-orange-600 text-white px-6 py-3 rounded-xl hover:bg-orange-700 font-bold shadow-sm transition-colors uppercase text-sm tracking-wider">
                            Generuj Zadania
                        </button>
                    </form>
                    {% if week.status == 'OPEN' %}
                        <form method="post" action="{{ path('admin_week_close', {'year': week.year, 'week': week.weekNumber}) }}" class="inline" onsubmit="return confirm('Czy na pewno chcesz zamknąć tydzień? Ta operacja jest nieodwracalna.');">
                            <button type="submit" class="bg-slate-900 text-white px-6 py-3 rounded-xl hover:bg-slate-950 font-bold shadow-sm transition-colors text-sm tracking-wider">
                                Zamknij Tydzień
                            </button>
                        </form>
                    {% endif %}
                    <a href="{{ path('admin_task_template_index') }}" class="px-6 py-3 border border-slate-200 text-slate-600 rounded-xl font-bold hover:bg-slate-50 transition-colors text-sm tracking-wider">
                        Szablony
                    </a>
                </div>
            </div>
        </div>

    {% for message in app.flashes('success') %}
        <div class="bg-gradient-to-r from-green-100 to-emerald-100 border-2 border-green-400 text-green-800 px-6 py-4 rounded-xl relative mb-6 shadow-lg" role="alert">
            <div class="flex items-center gap-2">
                <span class="text-2xl">✅</span>
                <span class="block sm:inline font-semibold">{{ message }}</span>
            </div>
        </div>
    {% endfor %}

     <!-- VUE MOUNT POINT -->
    <div id="vue-admin-week" class="bg-white border border-slate-200 rounded-2xl p-8 shadow-sm min-h-[400px]"
         data-week="{{ weekData|json_encode }}"
         data-tasks="{{ tasksData|json_encode }}"
         data-pending-tasks="{{ pendingTasksData|json_encode }}"
         data-workers="{{ workersData|json_encode }}"
         data-generate-url="{{ path('admin_week_generate', {'year': week.year, 'week': week.weekNumber}) }}"
         data-done-url-pattern="{{ path('admin_week_task_done', {'id': 'TASK_ID'}) }}"
         data-undo-url-pattern="{{ path('admin_week_task_undo', {'id': 'TASK_ID'}) }}"
          data-assign-url-pattern="{{ path('admin_week_task_assign', {'id': 'TASK_ID'}) }}"
          data-week-leaderboard="{{ weekLeaderboard|json_encode }}"
          data-team-total="{{ teamTotal }}">
         
         <!-- Loading state -->
         <div class="text-center py-24">
            <p class="text-xl text-slate-400 font-bold italic animate-pulse">Ładowanie widoku tygodnia...</p>
         </div>
    </div>
</div>
</div>

<!-- Welfare & Stock Summary -->
<div class="mt-12 max-w-[1100px] mx-auto px-6 pb-24">
    <h3 class="text-xl font-black text-slate-900 uppercase tracking-tighter mb-6 italic underline decoration-orange-500 decoration-4 underline-offset-4">Dobrostan i Stan Hodowli</h3>
    <div id="vue-welfare-widget"
         data-data-url="{{ path('welfare_data') }}"
         data-change-url="{{ path('welfare_change') }}">
         <div class="animate-pulse bg-white border border-slate-200 rounded-2xl h-64 shadow-sm"></div>
    </div>
</div>

{% endblock %}

